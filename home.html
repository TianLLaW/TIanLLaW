<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="/plugin/iview/styles/iview.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div id="app"></div>
<!-- main start -->
<script type="text/x-template" id="main">
<Col class="cs-container" span="20">
    <!-- 这个不能删除，用于面包屑显示 -->
    <slot name="breadcrumb"></slot>
    <div class="cs-content">
        <Row>
            <Col  :xs="globalConfig.xs" :sm="globalConfig.sm" :md="globalConfig.md" :lg="globalConfig.lg" >
                <Alert>
                  {{ $t('index.help') }}
                </Alert>
            </Col>
        </Row>
        <Row :gutter="26">
            <!-- content start -->
            <Col  :xs="globalConfig.xs" :sm="globalConfig.sm" :md="globalConfig.md" :lg="globalConfig.lg" >
                <!-- === -->
                    <div class="ivu-tabs ivu-tabs-card cs-tabs">
                        <div class="ivu-tabs-bar">
                            <div class="ivu-tabs-nav-container">
                                <div class="ivu-tabs-nav-wrap" style="position: relative;">
                                    <span class="ivu-tabs-nav-prev ivu-tabs-nav-scroll-disabled"><i class="ivu-icon ivu-icon-chevron-left"></i></span>  <span class="ivu-tabs-nav-next ivu-tabs-nav-scroll-disabled"><i class="ivu-icon ivu-icon-chevron-right"></i></span> 
                                    <div class="ivu-tabs-nav-scroll">
                                        <div class="nav-text ivu-tabs-nav">
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':1==showCurrentTabs}" @click="tabsSwitch(1)" v-show="showSysInfo">
                                                {{ $t('index.sys_info') }}
                                            </div>
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':2==showCurrentTabs}" @click="tabsSwitch(2)" v-show="showWanInfo">
                                                {{ $t('index.wan_info') }}
                                            </div>
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':4==showCurrentTabs}" @click="tabsSwitch(4)" v-show="showLanInfo">
                                                {{ $t('index.lan_info') }}
                                            </div>
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':5==showCurrentTabs}" @click="tabsSwitch(5)" v-show="showIPv6Info">
                                                {{ $t('index.ipv6_info') }}
                                            </div>
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':3==showCurrentTabs}" @click="tabsSwitch(3)" v-show="showLinkInfo">
                                                {{ $t('index.link_info') }}
                                            </div>
                                            <div :class="{'ivu-tabs-tab':true,'ivu-tabs-tab-active':6==showCurrentTabs}" @click="tabsSwitch(6)" v-show="showAboutInfo">
                                                {{ $t('index.about') }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ivu-tabs-content ivu-tabs-content-animated">
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 1">
                                <Table stripe :show-header="false" :columns="systemColumns" :loading="loading1" :data="systemData"></Table>
                            </div>
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 2">
                                <Table stripe :show-header="false" :columns="wanColumns" :loading="loading1" :data="wanData"></Table>
                            </div>
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 4">
                                <Table stripe :show-header="false" :columns="lanColumns" :loading="loading1" :data="lanData"></Table>
                            </div>
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 5">
                              <RadioGroup v-model="tab" type="button">
                                  <Radio label="0">{{ $t('ipv6_status.ipv6_wan_info') }}</Radio>
                                  <Radio label="1">{{ $t('ipv6_status.ipv6_lan_info') }}</Radio>
                              </RadioGroup>
                              <Row><br>
                                <Col v-show="tab == 0">
                                    <Table stripe :show-header="false" :columns="ipv6WanColumns" :data="ipv6WanData"></Table>
                                </Col>
                                <Col v-show="tab == 1">
                                    <Table stripe :show-header="false" :columns="ipv6LanColumns" :data="ipv6LanData"></Table>
                                </Col>
                              </Row>
                            </div>
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 3">
                              <RadioGroup v-model="tab" type="button">
                                  <Radio label="0" v-show="operationMode != '1'">{{ $t('realtime.net_info') }}</Radio>
                                  <Radio label="1">{{ $t('realtime.net_lan_info') }}</Radio>
                              </RadioGroup>
                              <Row>
                                <Col v-show="tab == 0">
                                    <div id="load_charts" style="width: 100%;height: 450px;"></div>
                                    <Row class="cs-table" >
                                      <Col span="6" class="right">{{ $t('realtime.type') }}:</Col>
                                      <Col span="6">{{ loadChartsData.type }}</Col>
                                      <Col span="6" class="right">{{ $t('realtime.status') }}:</Col>
                                      <Col span="6">{{ loadChartsData.status }}</Col>
                                    </Row>
                                    <Row class="cs-table">
                                      <Col span="6" class="right">{{ $t('realtime.ip') }}:</Col>
                                      <Col span="6">{{ loadChartsData.ip }}</Col>
                                      <Col span="6" class="right">{{ $t('realtime.gate') }}:</Col>
                                      <Col span="6">{{ loadChartsData.gateway }}</Col>
                                    </Row>
                                    <Row class="cs-table">
                                      <Col span="6" class="right">{{ $t('realtime.up') }}:</Col>
                                      <Col span="6">{{ loadChartsData.up }}</Col>
                                      <Col span="6" class="right">{{ $t('realtime.down') }}:</Col>
                                      <Col span="6">{{ loadChartsData.down }}</Col>
                                    </Row>
                                </Col>
                                <Col v-show="tab == 1">
                                    <div id="links_charts" style="width: 100%;height: 450px;"></div>
                                    <Table border ref="tableSelect" :columns="linksChartsColumns" :data="linksChartsData.connections"></Table>
                                </Col>
                              </Row>
                            </div>
                            <div class="ivu-tabs-tabpane" v-show="showCurrentTabs == 6">
                                <Table stripe :show-header="false" :columns="aboutColumns" :loading="loading1" :data="aboutData"></Table>
                            </div>
                        </div>
                    </div>
            </Col>
            <!-- content end -->
        </Row>
    </div>
    <Modal
        v-model="showModel"
        :title="$t('realtime.links_conut')+'( '+analysisData.length+' )'"
        :okText="$t('common.ok')"
        :cancelText="$t('common.cancel')"
        :width="700"
        >
        <Table :columns="analysisColumns" :data="analysisData" :loading="showModelLoading" >
        </Table>
    </Modal>
    <div style="display: none;">{{ tabs }}</div>
    <!-- 这个不能删除，用于底部显示 -->
    <slot name="footer"></slot>
</Col>
</script>
<!-- main end -->

<script src="/plugin/vue.js"></script>
<script src="/plugin/vue-i18n.js"></script>
<script src="/plugin/iview/iview.js"></script>
<script src="/plugin/jquery-1.11.3.min.js"></script>
<script src="/plugin/util.js"></script>
<script src="/plugin/echarts.min.js"></script>
<script src="/static/js/language.js"></script>
<script src="/static/js/config.js"></script>
<script src="/static/js/layout.js"></script>
<script src="/static/js/common.js"></script>
<script src="/static/js/topicurl.js"></script>
<script>
// current code
var cs_main = {
    template: '#main',
    data: function() {
        var _this = this;
        return {
            menu: menu,
            globalConfig: globalConfig,
            loading1: false,
            showSysInfo:false,
            showWanInfo:false,
            showLanInfo:false,
            showIPv6Info:false,
            showLinkInfo:false,
            showAboutInfo:false,
            showCurrentTabs: "1",
            operationMode: '',
            totalUpTime:'',
            upTime: [],
            customerUrl: '',
            fmVersion: '',
            buildTime: '',
            wanMode: '',
            wanConnStatus: '',
            wanConnTime: [],
            wanIp: '',
            wanMask: '',
            wanGw: '',
            priDns: '',
            secDns: '',
            wanMac: '',
            lanIp: '',
            lanMask: '',
            dhcpServer: '',
            lanMac: '',
            wanTx: '',
            wanRx: '',
            lanTx: '',
            lanRx: '',
            lanUserNum: '',
            applyLoading: false,
            tab: '',
            timestamp: 3000,
            loadChartsData: {
                type: '',
                status: '',
                ip: '',
                gateway: '',
                up: '',
                down: ''
            },
            linksChartsData: {
                connections: []
            },
            timer: {},
            timerNum: 0,
            start: false,
            showModel: false,
            analysisData: [],
            showModelLoading:true,
            wanEnabled:'',
            connStatus:'',
            connMode:'',
            ipv6WanIp:'',
            ipv6WanGw:'',
            ipv6WanPriDns:'',
            ipv6WanSecDns:'',
            wanIPv6:'',
            wanIPv6PrefixLen:'',
            lanIPv6:'',
            lanIPv6PrefixLen:'',
            wanPriDnsIPv6:'',
            wanSecDnsIPv6:'',
            lanIPv6Local:'',
            lanGlobalPrefixLen:'',
            lanLinkIp:'',
            lanLinkPrefixLen:'',
            cpuRatio:'',
            memRatio:'',
            curConnectNum:'',
            maxconnectNum:'',
            productName:''
        }
    },
    computed: {
        systemColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('index.cpu_ratio')) {
                        params.row.value = _this.cpuRatio + " %";
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.mem_ratio')) {
                        params.row.value = _this.memRatio + " %";
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.user_num')) {
                        return h('div',[
                            _this.lanUserNum + ' ',
                            h('Button',{
                                props:{
                                    shape: "circle",
                                    icon: "ios-search",
                                    size: "small"
                                },
                                on:{
                                    click:function(){
                                        _this.showCurrentTabs = '3';
                                        _this.tab = '1';
                                    }
                                }
                            })
                        ]);
                    }
                    if (params.row.name == _this.$t('index.link_num')) {
                        params.row.value = _this.curConnectNum +" / "+_this.maxconnectNum;
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.total_uptime')) {
                        var v = _this.totalUpTime.split(";");
                        params.row.value = v[0] + " " + _this.$t('index.day') + " " + v[1] + " " + _this.$t('index.hour') + " " + v[2] + " " + _this.$t('index.min') + " " + v[3] + " " + _this.$t('index.sec');
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.up_time')) {
                        params.row.value = _this.upTime[0] + " " + _this.$t('index.day') + " " + _this.upTime[1] + " " + _this.$t('index.hour') + " " + _this.upTime[2] + " " + _this.$t('index.min') + " " + _this.upTime[3] + " " + _this.$t('index.sec');
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.op_mode')) {
                        if (_this.operationMode == 0) {
                            params.row.value = _this.$t('index.gateway_mode');
                            return h('div', params.row.value);
                        } else if (_this.operationMode == 1) {
                            params.row.value = _this.$t('index.bridge_mode');
                            return h('div', params.row.value);
                        } else if (_this.operationMode == 2) {
                            params.row.value = _this.$t('index.repeater_mode');
                            return h('div', params.row.value);
                        } else if (_this.operationMode == 3) {
                            params.row.value = _this.$t('index.wisp_mode');
                            return h('div', params.row.value);
                        }
                    }
                }
            }]
        },
        systemData: function() {
            var data1 = [{
                    name: this.$t('index.cpu_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.mem_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.link_num'),
                    value: '',
                }, {
                    name: this.$t('index.user_num'),
                    value: '',
                }, {
                    name: this.$t('index.total_uptime'),
                    value: ''
                }, {
                    name: this.$t('index.up_time'),
                    value: ''
                }, {
                    name: this.$t('index.op_mode'),
                    value: '',
                }];
            var data2 = [{
                    name: this.$t('index.cpu_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.mem_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.total_uptime'),
                    value: ''
                }, {
                    name: this.$t('index.up_time'),
                    value: ''
                }, {
                    name: this.$t('index.op_mode'),
                    value: '',
                }];
            if(this.totalUpTime == ""){
                return [{
                    name: this.$t('index.cpu_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.mem_ratio'),
                    value: '',
                }, {
                    name: this.$t('index.link_num'),
                    value: '',
                }, {
                    name: this.$t('index.user_num'),
                    value: '',
                }, {
                    name: this.$t('index.up_time'),
                    value: ''
                }, {
                    name: this.$t('index.op_mode'),
                    value: '',
                }];
            }else{
                if(this.operationMode == 1 || this.operationMode == 2){
                    return data2;
                }else{
                    return data1;
                }
            }
        },
        wanColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('index.wan_status')) {
                        if (_this.wanMode == 0) {
                            if (_this.wanConnStatus == "connected") {
                                params.row.value = _this.$t('index.staticIp_mode') + _this.$t('index.connected');
                            } else {
                                params.row.value = _this.$t('index.staticIp_mode') + _this.$t('index.disconnected');
                            }
                            return h('div', params.row.value);
                        } else if (_this.wanMode == 1) {
                            if (_this.wanConnStatus == "connected") {
                                params.row.value = 'DHCP' + _this.$t('index.connected');
                            } else {
                                params.row.value = 'DHCP' + _this.$t('index.disconnected');
                            }
                            return h('div', params.row.value);
                        } else if (_this.wanMode == 3) {
                            if (_this.wanConnStatus == "connected") {
                                params.row.value = 'PPPoE' + _this.$t('index.connected');
                            } else {
                                params.row.value = 'PPPoE' + _this.$t('index.disconnected');
                            }
                            return h('div', params.row.value);
                        } else if (_this.wanMode == 4) {
                            if (_this.wanConnStatus == "connected") {
                                params.row.value = 'PPTP' + _this.$t('index.connected');
                            } else {
                                params.row.value = 'PPTP' + _this.$t('index.disconnected');
                            }
                            return h('div', params.row.value);
                        } else if (_this.wanMode == 6) {
                            if (_this.wanConnStatus == "connected") {
                                params.row.value = 'L2TP' + _this.$t('index.connected');
                            } else {
                                params.row.value = 'L2TP' + _this.$t('index.disconnected');
                            }
                            return h('div', params.row.value);
                        }
                    }
                    if (params.row.name == _this.$t('index.wan_time')) {
                        params.row.value = _this.wanConnTime[0] + " " + _this.$t('index.day') + " " + _this.wanConnTime[1] + " " + _this.$t('index.hour') + " " + _this.wanConnTime[2] + " " + _this.$t('index.min') + " " + _this.wanConnTime[3] + " " + _this.$t('index.sec');
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.ip')) {
                        if (_this.wanConnStatus == "connected") {
                            params.row.value = _this.wanIp;
                        } else {
                            params.row.value = "0.0.0.0";
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.mask')) {
                        if (_this.wanConnStatus == "connected") {
                            params.row.value = _this.wanMask;
                        } else {
                            params.row.value = "0.0.0.0";
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.gateway')) {
                        if (_this.wanConnStatus == "connected") {
                            params.row.value = _this.wanGw;
                        } else {
                            params.row.value = "0.0.0.0";
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.dns_server')) {
                        if (_this.secDns == "") {
                            if (_this.wanMode != "" && _this.wanConnStatus == "connected") {
                                params.row.value = _this.priDns;
                            } else {
                                params.row.value = "0.0.0.0";
                            }
                        } else {
                            if (_this.wanMode !== "" && _this.wanConnStatus == "connected") {
                                params.row.value = _this.priDns + '/' + _this.secDns;
                            } else {
                                params.row.value = "0.0.0.0 / 0.0.0.0";
                            }
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.mac_address')) {
                        params.row.value = _this.wanMac;
                        return h('div', params.row.value);
                    }
                }
            }]
        },
        wanData: function() {
            return [{
                name: this.$t('index.wan_status'),
                value: "",
            }, {
                name: this.$t('index.wan_time'),
                value: "",
            }, {
                name: this.$t('index.ip'),
                value: "",
            }, {
                name: this.$t('index.mask'),
                value: "",
            }, {
                name: this.$t('index.gateway'),
                value: "",
            }, {
                name: this.$t('index.dns_server'),
                value: ""
            }, {
                name: this.$t('index.mac_address'),
                value: ""
            }]
        },
        lanColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('index.ip')) {
                        params.row.value = _this.lanIp;
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.mask')) {
                        params.row.value = _this.lanMask;
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.dhcp_server')) {
                        if (_this.dhcpServer == "1") {
                            params.row.value = _this.$t('index.enabled');
                        } else {
                            params.row.value = _this.$t('index.disabled');
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.mac_address')) {
                        params.row.value = _this.lanMac;
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.user_num')) {
                        return h('div',[
                                _this.lanUserNum + ' ',
                                h('Button',{
                                    props:{
                                        shape: "circle",
                                        icon: "ios-search",
                                        size: "small"
                                    },
                                    on:{
                                        click:function(){
                                            _this.showCurrentTabs = '3';
                                            _this.tab = '1';
                                        }
                                    }
                                })
                            ]);
                    }
                }
            }]
        },
        lanData: function() {
            var obj = [];
            var obj1 = [];
            obj = [{
                    name: this.$t('index.ip'),
                    value: "",
                }, {
                    name: this.$t('index.mask'),
                    value: "",
                }, {
                    name: this.$t('index.dhcp_server'),
                    value: "",
                }, {
                    name: this.$t('index.mac_address'),
                    value: "",
                }, {
                    name: this.$t('index.user_num'),
                    value: "",
                }];
            obj1 = [{
                    name: this.$t('index.ip'),
                    value: "",
                }, {
                    name: this.$t('index.mask'),
                    value: "",
                }, {
                    name: this.$t('index.mac_address'),
                    value: "",
                }];
            if(this.globalConfig.currentMode == "BR"){
                return obj1;
            }else{
                return obj;
            }
        },
        statisticsColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value1',
                key: 'value1',
                render: function(h, params) {
                    if (params.row.name == "") {
                        params.row.value1 = _this.$t('index.rx_packets');
                        return h('div', params.row.value1);
                    }
                    if (params.row.name == "WAN") {
                        params.row.value1 = _this.wanTx;
                        return h('div', params.row.value1);
                    }
                    if (params.row.name == "LAN") {
                        params.row.value1 = _this.lanTx;
                        return h('div', params.row.value1);
                    }
                }
            }, {
                title: 'value2',
                key: 'value2',
                render: function(h, params) {
                    if (params.row.name == "") {
                        params.row.value2 = _this.$t('index.tx_packets');
                        return h('div', params.row.value2);
                    }
                    if (params.row.name == "WAN") {
                        params.row.value2 = _this.wanRx;
                        return h('div', params.row.value2);
                    }
                    if (params.row.name == "LAN") {
                        params.row.value2 = _this.lanRx;
                        return h('div', params.row.value2);
                    }
                }
            }]
        },
        statisticsData: function() {
            return [{
                name: "",
                value1: "",
                value2: ""
            }, {
                name: "WAN",
                value1: "",
                value2: ""
            }, {
                name: "LAN",
                value1: "",
                value2: ""
            }]
        },
        tabs: function() {
            var _this = this;
            if (this.start || this.timerNum == 2) {
                this.timerNum = 0;
                for (var _i in this.timer) {
                    this.timerNum++;
                    clearInterval(this.timer[_i]);
                }
                if (this.showCurrentTabs == 3 && this.tab == 0) {
                    this.timer.loadChartsTimer = setInterval(function() {
                        _this.functionLoadCharts();
                    }, this.timestamp);
                } else if (this.showCurrentTabs == 3 && this.tab == 1) {
                    this.timer.linksChartsTimer = setInterval(function() {
                        _this.functionLinksCharts();
                    }, this.timestamp);
                }
            }
            return this.tab;
        },
        linksChartsColumns: function() {
            var _this = this;
            return [{
                title: this.$t('realtime.source'),
                key: 'src',
                width:'125px',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"ip");
                }
            }, {
                title: this.$t('realtime.count_downloads'),
                key: 'count_download',
                width:'100px',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"num");
                },
                render: function(h, params) {
                    return h('span', cs.bytesToSize(parseInt(params.row.count_download)));
                }
            }, {
                title: this.$t('realtime.count_upload'),
                key: 'count_upload',
                width:'100px',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"num");
                },
                render: function(h, params) {
                    return h('span', cs.bytesToSize(parseInt(params.row.count_upload)));
                }
            }, {
                title: this.$t('realtime.download_speed'),
                key: 'download',
                width:'100px',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"num");
                },
                render: function(h, params) {
                    return h('span', params.row.download + ' KB/s');
                }
            }, {
                title: this.$t('realtime.upload_speed'),
                key: 'upload',
                width:'100px',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"num");
                },
                render: function(h, params) {
                    return h('span', params.row.upload + ' KB/s');
                }
            }, {
                title: this.$t('realtime.links_conut'),
                key: 'src',
                width:'95px',
                sortable: true,
                render: function(h, params) {
                    return h('a', {
                        attrs: {
                            href: 'javascript:;',
                        },
                        on: {
                            click: function() {
                                _this.showLinksModel(params);
                            }
                        },
                        domProps: {
                            innerHTML: _this.$t('realtime.see')
                        }
                    });
                }
            }];
        },
        analysisColumns: function() {
            var _this = this;
            return [{
                title: this.$t('realtime.protocol'),
                key: 'protocol',
                width: '60',
                sortable: true
            }, {
                title: this.$t('realtime.address'),
                key: 'src',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"ip");
                },
                render: function(h, params) {
                    return h('span', params.row.src + ':' + params.row.sport);
                }
            }, {
                title: this.$t('realtime.interface'),
                key: 'net',
                width: '80',
                sortable: true
            }, {
                title: this.$t('realtime.target_address'),
                key: 'dst',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"ip");
                },
                render: function(h, params) {
                    return h('span', params.row.dst + ':' + params.row.dport);
                }
            }, {
                title: this.$t('realtime.connection_time'),
                key: 'time',
                sortable: true,
                sortMethod:function(a,b,type){
                    return _this.rank(a,b,type,"time");
                },
            }]
        },
        ipv6WanColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('ipv6_status.connect_type')) {
                        if (_this.wanEnabled == 0) {
                          params.row.value = "Disable";
                          return h('div', params.row.value);
                        } else{
                          if (_this.connMode == 0) {
                            if(_this.connStatus == "connected"){
                              params.row.value = _this.$t('ipv6_status.static_ip') + _this.$t('ipv6_status.connected');
                            }else{
                              params.row.value = _this.$t('ipv6_status.static_ip') + _this.$t('ipv6_status.disconnected');
                            } 
                            return h('div', params.row.value);
                          } else if (_this.connMode == 2) {
                            if(_this.connStatus == "connected"){
                              params.row.value = _this.$t('ipv6_status.dynamic_ip') + _this.$t('ipv6_status.connected');
                            }else{
                              params.row.value = _this.$t('ipv6_status.dynamic_ip') + _this.$t('ipv6_status.disconnected');
                            } 
                            return h('div', params.row.value);
                          } else if (_this.connMode == 1) {
                            if(_this.connStatus == "connected"){
                              params.row.value = "PPPoE" + _this.$t('ipv6_status.connected');
                            }else{
                              params.row.value = "PPPoE" + _this.$t('ipv6_status.disconnected');
                            } 
                            return h('div', params.row.value);
                          } 
                        } 
                    }
                    if (params.row.name == _this.$t('ipv6_status.ipv6_ip')) {
                        if (_this.wanEnabled == 0) {
                            params.row.value = "::";
                        } else{
                                if(_this.ipv6WanIp == "")
                                    params.row.value = "::";
                                else
                                     params.row.value = _this.ipv6WanIp;
                        } 
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('ipv6_status.gateway')) {
                        if (_this.wanEnabled == 0) {
                            params.row.value = "::";
                        } else{
                                if(_this.ipv6WanGw == "")
                                    params.row.value = "::";
                                else
                                    params.row.value = _this.ipv6WanGw;
                        } 
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('ipv6_status.pri_dns')) {
                        if (_this.wanEnabled == 0) {
                            params.row.value = "::";
                        } else{
                                if(_this.ipv6WanPriDns == "")
                                    params.row.value = "::";
                                else
                                    params.row.value = _this.ipv6WanPriDns;
                        } 
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('ipv6_status.sec_dns')) {
                        if (_this.wanEnabled == 0) {
                            params.row.value = "::";
                        } else{
                                if(_this.ipv6WanSecDns == "")
                                    params.row.value = "::";
                                else
                                    params.row.value = _this.ipv6WanSecDns;
                        } 
                        return h('div', params.row.value);
                    }
                }
            }]
        },
        ipv6WanData: function() {
            return [{
                name: this.$t('ipv6_status.connect_type'),
                value: "",
            }, {
                name: this.$t('ipv6_status.ipv6_ip'),
                value: "",
            }, {
                name: this.$t('ipv6_status.gateway'),
                value: "",
            }, {
                name: this.$t('ipv6_status.pri_dns'),
                value: "",
            }, {
                name: this.$t('ipv6_status.sec_dns'),
                value: "",
            }]
        },
        ipv6LanColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('ipv6_status.addr_type')) {
                        params.row.value = "SLAAC+DHCPv6";
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('ipv6_status.ipv6_ip')) {
                        if (_this.wanEnabled == "0") {
                            params.row.value = "::";
                        } else {
                                if(_this.lanIPv6Local == "")
                                    params.row.value = "FE80";
                                else
                                    params.row.value = _this.lanIPv6Local;
                        }
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('ipv6_status.local_connect_type')) {
                        if (_this.wanEnabled == "0") {
                            params.row.value = "FE80:";
                        } else {
                                if(_this.lanIPv6Local == "")
                                    params.row.value = "FE80";
                                else
                                    params.row.value = _this.lanLinkIp;
                        }
                        return h('div', params.row.value);
                    }
                }
            }]
        },
        ipv6LanData: function() {
            return [{
                name: this.$t('ipv6_status.addr_type'),
                value: "",
            }, {
                name: this.$t('ipv6_status.ipv6_ip'),
                value: "",
            }, {
                name: this.$t('ipv6_status.local_connect_type'),
                value: "",
            }]
        },
        aboutColumns: function() {
            var _this = this;
            return [{
                title: 'title',
                key: 'name'
            }, {
                title: 'value',
                key: 'value',
                render: function(h, params) {
                    if (params.row.name == _this.$t('index.website')) {
                        params.row.value = _this.customerUrl;
                        return h('a', {
                            attrs: {
                                href: 'http://'+params.row.value,
                                target:"_blank",
                            }
                        }, params.row.value);
                    }
                    if (params.row.name == _this.$t('index.version')) {
                        params.row.value = _this.fmVersion;
                        return h('div', params.row.value);
                    }
                    if (params.row.name == _this.$t('index.build_time')) {
                        params.row.value = _this.buildTime;
                        return h('div', params.row.value);
                    }
                }
            }]
        },
        aboutData: function() {
            if(this.customerUrl == "" || this.customerUrl == undefined){
                return [{
                    name: this.$t('index.version'),
                    value: '',
                }, {
                    name: this.$t('index.build_time'),
                    value: '',
                }]
            }else{
                return [{
                    name: this.$t('index.website'),
                    value: '',
                }, {
                    name: this.$t('index.version'),
                    value: '',
                }, {
                    name: this.$t('index.build_time'),
                    value: '',
                }]
            }
        },
    },
    created: function() {
        var _this = this;
        _this.init();
        if(globalConfig.showIPv6){
            _this.ipv6_info();  
        }
    },
    updated: function() {
        if (this.showCurrentTabs == 3 && this.tab == 0 && !this.timer.loadChartsTimer) {
            this.start = true;
            this.loadCharts();
        } else if (this.showCurrentTabs == 3 && this.tab == 1 && !this.timer.linksChartsTimer) {
            this.start = true;
            this.linksCharts();
        } else {
            this.start = false;
        }
    },
    methods: {
        tabsSwitch: function(index) {
            var _this = this;
            if(index == 5){
                _this.ipv6_info();  
            }
            if(index != 3 && index != 5){
                _this.init();
            }
            this.showCurrentTabs = index;
        },
        init: function(){
            var _this = this;
            _this.loading1 = true;
            uiPost.getSysStatusCfg(function(data) {
                if (data.operationMode == 0) {
                    _this.operationMode = 0;
                } else if (data.operationMode == 3) {
                    _this.operationMode = 3;
                } else if (data.operationMode == 4 || data.operationMode == 5) {
                    _this.operationMode = 4;
                } else {
                    if (data.apcliEnable == 1 || data.apcliEnable5g == 1) {
                        _this.operationMode = 2;
                    } else {
                        _this.operationMode = 1;
                    }
                }
                _this.showSysInfo = true;
                _this.showLanInfo = true;
                _this.showAboutInfo = true;
                if(_this.operationMode == 1){
                    _this.tab = "1";
                    _this.showWanInfo = false;
                }else{
                    _this.tab = "0";
                    _this.showWanInfo = true;
                }
                _this.showLinkInfo = _this.globalConfig.showLinkInfo; 
                if(_this.showLinkInfo == true){
                    if(_this.operationMode == 1){
                        _this.tab = "1";
                        _this.showLinkInfo = false;
                    }else{
                        _this.tab = "0";
                        _this.showLinkInfo = true;
                    }
                }
                if(data.totalUpTime != undefined){
                    _this.totalUpTime = data.totalUpTime;
                }
                _this.upTime = data.upTime.split(";");
                _this.customerUrl = data.customerUrl;
                _this.fmVersion = data.fmVersion;
                if (data.buildTime.indexOf("-") != -1){
                    _this.buildTime = data.buildTime;
                }else{
                    var _time =  /\s+/g;
                    var time_ = data.buildTime.replace(_time, ' ');
                    var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    for (var j = 0; j < 12; j++) {
                        if (time_.split(" ")[0] == month[j]) {
                            var time = j + 1;
                        }
                    }
                    _this.buildTime = time_.split(" ")[2] + "-" + time + "-" + time_.split(" ")[1] + " " + time_.split(" ")[3];
                }
                _this.wanMode = data.wanMode;
                _this.wanConnStatus = data.wanConnStatus;
                _this.wanConnTime = data.wanConnTime.split(";");
                _this.wanIp = data.wanIp;
                _this.wanMask = data.wanMask;
                _this.wanGw = data.wanGw;
                _this.priDns = data.priDns;
                _this.secDns = data.secDns;
                _this.wanMac = data.wanMac;
                _this.lanIp = data.lanIp;
                _this.lanMask = data.lanMask;
                _this.dhcpServer = data.dhcpServer;
                _this.lanMac = data.lanMac;
                _this.wanTx = data.wanTx;
                _this.wanRx = data.wanRx;
                _this.lanTx = data.lanTx;
                _this.lanRx = data.lanRx;
                _this.lanUserNum = data.lanUserNum;
                _this.loading1 = false;
                _this.cpuRatio = data.cpuRatio;
                _this.memRatio = data.memRatio;
                _this.curConnectNum = data.curConnectNum;
                _this.maxconnectNum = data.maxconnectNum;
                _this.productName = data.productName;
            })
        },
        ipv6_info: function(){
            var _this = this;
            uiPost.getIPv6Status(function(data) {
                _this.wanEnabled = data.enabled;
                _this.connStatus = data.connStatus;
                _this.connMode = data.connMode;
                _this.ipv6WanIp = data.wanIp;
                _this.ipv6WanGw = data.wanGw;
                _this.ipv6WanPriDns = data.wanPriDns;
                _this.ipv6WanSecDns = data.wanSecDns;
                _this.wanIPv6PrefixLen = data.wanIpPrefixLen;
                _this.lanIPv6PrefixLen = data.lanIPv6PrefixLen;
                _this.wanPriDnsIPv6 = data.wanPriDns;
                _this.wanSecDnsIPv6 = data.wanSecDns;
                _this.lanIPv6Local = data.lanGlobalIp;
                _this.lanGlobalPrefixLen = data.lanGlobalPrefixLen;
                _this.lanLinkIp = data.lanLinkIp;
                _this.lanLinkPrefixLen = data.lanLinkPrefixLen;
                _this.showIPv6Info = true;
            })
        },
        loadCharts: function() {
            var _this = this;
            this.loadChartsData.load_x = new Array(50);
            this.loadChartsData.load_y = new Array(50);
            this.loadChartsData.load_y1 = new Array(50);
            this.loadChartsData.load_x_i = 0;
            for (var i = 0; i < this.loadChartsData.load_x.length; i++) {
                this.loadChartsData.load_x[i] = '';
                this.loadChartsData.load_y[i] = 0;
                this.loadChartsData.load_y1[i] = 0;
            }
            this.loadChartsData.load_charts_option = {
                animation: false,
                xAxis: [{
                    type: 'category',
                    data: this.loadChartsData.load_x
                }],
                yAxis: [{
                    type: 'value',
                    min: 0,
                    name: "KB/s"
                }],
                legend: {
                    type: "plain",
                    data: [this.$t('realtime.up'), this.$t('realtime.down')]
                },
                series: [{
                    name: this.$t('realtime.up'),
                    type: 'line',
                    stack: '1',
                    symbol: 'none',
                    smooth: true,
                    itemStyle: {
                        normal: {
                            width: 1,
                            color: '#C23531'
                        }
                    },
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: '#C23531'
                            }, {
                                offset: 1,
                                color: '#fff'
                            }])
                        }
                    },
                    data: this.loadChartsData.load_y
                }, {
                    name: this.$t('realtime.down'),
                    type: 'line',
                    stack: '2',
                    symbol: 'none',
                    smooth: true,
                    itemStyle: {
                        normal: {
                            width: 1,
                            color: '#2F4554'
                        }
                    },
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: '#2F4554'
                            }, {
                                offset: 1,
                                color: '#fff'
                            }])
                        }
                    },
                    data: this.loadChartsData.load_y1
                }, ],
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            backgroundColor: '#6a7985'
                        }
                    }
                }
            };
            this.loadChartsData.load_charts = document.getElementById("load_charts");
            this.loadChartsData.e_load_charts = echarts.init(this.loadChartsData.load_charts);
            this.loadChartsData.e_load_charts.setOption(this.loadChartsData.load_charts_option);

            this.timer.loadChartsTimer = setInterval(function() {
                _this.functionLoadCharts();
            }, this.timestamp);
        },
        functionLoadCharts: function() {
            var _this = this;
            uiPost.getNetInfo(function(data) {
                var type = data.type;
                var status = data.status;
                _this.loadChartsData.load_x.shift();
                _this.loadChartsData.load_y.shift();
                _this.loadChartsData.load_y1.shift();
                _this.loadChartsData.load_x.push(_this.formatDate('mm:ss', data.timestamp));
                _this.loadChartsData.load_y.push(data.up);
                _this.loadChartsData.load_y1.push(data.down);
                _this.loadChartsData.e_load_charts.setOption({
                    xAxis: [{
                        data: _this.loadChartsData.load_x
                    }],
                    series: [{
                        data: _this.loadChartsData.load_y
                    }, {
                        data: _this.loadChartsData.load_y1
                    }]
                });
                // 其他显示
                _this.loadChartsData.type = (type == 1 ? "DHCP" : type == 2 ? _this.$t('realtime.staticip') : "PPPoE");
                _this.loadChartsData.status = (status == 1 ? _this.$t('realtime.succ') : _this.$t('realtime.fail'));
                _this.loadChartsData.ip = (data.ip);
                _this.loadChartsData.gateway = (data.gateway);
                _this.loadChartsData.up = (data.up + ' KB/s');
                _this.loadChartsData.down = (data.down + ' KB/s');
            });
        },
        linksCharts: function() {
            var _this = this;
            this.linksChartsData.links_x = new Array(100);
            this.linksChartsData.links_y = new Array(100);
            this.linksChartsData.links_y1 = new Array(100);
            this.linksChartsData.connections = [];
            this.linksChartsData.links_x_i = 0;
            for (var i = 0; i < this.linksChartsData.links_x.length; i++) {
                this.linksChartsData.links_x[i] = 0;
                this.linksChartsData.links_y[i] = 0;
                this.linksChartsData.links_y1[i] = 0;
            }
            this.linksChartsData.links_charts_option = {
                xAxis: [{
                    show: false,
                    type: 'category',
                    data: this.linksChartsData.links_x
                }],
                yAxis: [{
                    type: 'value',
                    min: 0
                }],
                legend: {
                    type: "plain",
                    data: ['TCP', 'UDP']
                },
                series: [{
                    name: "TCP",
                    type: 'line',
                    smooth: true,
                    symbol: 'none',
                    itemStyle: {
                        normal: {
                            width: 1,
                            color: '#0095C5'
                        }
                    },
                    stack: 'a',
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: '#0095C5'
                            }, {
                                offset: 1,
                                color: '#fff'
                            }])
                        }
                    },
                    data: this.linksChartsData.links_y
                }, {
                    name: "UDP",
                    type: 'line',
                    smooth: true,
                    stack: 'a1',
                    symbol: 'none',
                    itemStyle: {
                        normal: {
                            width: 1,
                            color: '#F5AE10'
                        }
                    },
                    areaStyle: {
                        normal: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: '#F5AE10'
                            }, {
                                offset: 1,
                                color: '#fff'
                            }])
                        }
                    },
                    data: this.linksChartsData.links_y1
                }],
                animation: false
            };
            this.linksChartsData.links_charts = document.getElementById("links_charts");
            this.linksChartsData.e_links_charts = echarts.init(this.linksChartsData.links_charts);
            this.linksChartsData.e_links_charts.setOption(this.linksChartsData.links_charts_option);
            this.timer.linksChartsTimer = setInterval(function() {
                _this.functionLinksCharts();
            }, this.timestamp);
        },
        functionLinksCharts: function() {
            var _this = this;
            uiPost.getLinksData(function(data) {
                _this.linksChartsData.links_x.shift();
                _this.linksChartsData.links_y.shift();
                _this.linksChartsData.links_y1.shift();
                _this.linksChartsData.links_x.push(_this.linksChartsData.links_x_i++);
                _this.linksChartsData.links_y.push(data.statistics.tcp);
                _this.linksChartsData.links_y1.push(data.statistics.udp);
                _this.linksChartsData.e_links_charts.setOption({
                    xAxis: [{
                        data: _this.linksChartsData.links_x
                    }],
                    series: [{
                        data: _this.linksChartsData.links_y
                    }, {
                        data: _this.linksChartsData.links_y1
                    }]
                });
                _this.linksChartsData.connections = _this.compare(data.connections);
            });
        },
        compare:function(arr){
            var arr1 = arr.sort(function (x, y) {
                var a = Number(x.src.split('.')[2]);
                var b = Number(y.src.split('.')[2]);
                var c = Number(x.src.split('.')[3]);
                var d = Number(y.src.split('.')[3]);
                if (a > b) {
                    return 1;
                } else if (a === b) {
                    return c > d ? 1 : -1;
                } else if (a < b) {
                    return -1;
                }
            })
            return arr1;
        },
        rank: function(a,b,type,str){
            var n=m=k=l=0;
            if(str == "ip"){
                n = Number(a.split('.')[2]);
                m = Number(b.split('.')[2]);
                k = Number(a.split('.')[3]);
                l = Number(b.split('.')[3]);
            }else if(str == "num"){
                n = Number(a);
                m = Number(b);
            }else if(str == "time"){
                n = a;
                m = b;
            }
            if(type == 'asc'){
                if(n > m){
                    return 1;
                }else if(n == m && str == "ip"){
                    return k > l ? 1 : -1;
                }else if(n < m){
                    return -1;
                }
            }else{
                if(n > m){
                    return -1;
                }else if(n == m && str == "ip"){
                    return k > l ? -1 : 1;
                }else if(n < m){
                    return 1;
                }
            }
        },
        showLinksModel: function(params) {
            var _this = this;
            var postVar = {'src':params.row.src};
            this.showModel = true;
            this.showModelLoading = true;
            uiPost.getLinksIpData(postVar,function(data){
                _this.analysisData = data;
                _this.showModelLoading = false;
            })
        },
        formatDate: function(fmt, timestamp) {
            var date = new Date(Number(timestamp * 1000));
            var o = {
                "M+": date.getMonth() + 1, //月份 
                "d+": date.getDate(), //日 
                "h+": date.getHours(), //小时 
                "m+": date.getMinutes(), //分 
                "s+": date.getSeconds(), //秒 
                "q+": Math.floor((date.getMonth() + 3) / 3), //季度 
                "S": date.getMilliseconds() //毫秒 
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }
    }
};
</script>
<script src="static/js/main.js"></script>
</body>
</html>